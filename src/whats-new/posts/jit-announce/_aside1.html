<article class="unison-doc"><section><p><span class="span"><span class="word">Consider the expression:</span></span></p><div class="rich source code raw"><pre><code><span class="word">    (+ 1 2
      (reset
        (+ 1
           2
           (shift (lambda (k) (k (k 5))))
           3)))
</span></code></pre></div><p><span class="span"><span class="word">This evaluates to</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">20</span></code></span><span class="word">,</span></span></span><span class="word">because the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">k</span></code></span><span class="word">captured is essentially the inner addition, meaning it&#39;s equivalent to:</span></span></p><div class="rich source code raw"><pre><code><span class="word">    (let ((f (lambda (x) (+ 1 2 x 3))))
      (+ 1 2 (f (f 5))))
</span></code></pre></div><p><span class="span"><span class="word">If the</span><span class="rich source inline-code"><code class="inline-code"><span class="word">shift</span></code></span><span class="word">is replaced with</span><span class="rich source inline-code"><code class="inline-code"><span class="word">call/cc</span></code></span><span class="word">(removing the redundant</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">reset</span></code></span><span class="word">),</span></span></span><span class="word">then the result is</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">14</span></code></span><span class="word">,</span></span></span><span class="word">because it is equivalent to:</span></span></p><div class="rich source code raw"><pre><code><span class="word">    (+ 1 2 (+ 1 2 5 3))
</span></code></pre></div><p><span class="span"><span class="word">If you want, you can also try using delimited continuations in Unison.</span><span class="rich source inline-code"><code class="inline-code"><span class="word">shift</span></code></span><span class="word">is the effect part, introduced by the ability:</span></span></p><div class="folded-sources"><details open="open" class="folded rich source"><summary class="folded-content folded-summary"><pre><code><span class="syntax"><span class="data-type-modifier">structural</span><span class="blank"> </span><span class="data-type-keyword">ability</span><span class="blank"> </span><span class="hash-qualifier">Shift</span><span class="blank"> </span><span class="data-type-params">r</span></span></code></pre></summary><div class="folded-content folded-details"><pre><code><span class="syntax"><span class="data-type-modifier">structural</span><span class="blank"> </span><span class="data-type-keyword">ability</span><span class="blank"> </span><span class="hash-qualifier">Shift</span><span class="blank"> </span><span class="data-type-params">r</span><span class="control-keyword"> where</span><span class="blank">
</span><span class="blank">  </span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug#a0" class="term-reference" data-ref-type="term">shift</span><span class="type-ascription-colon"> :</span><span class="blank"> </span><span class="blank">(</span><span class="blank">(</span><span class="var">a</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">r</span><span class="blank">)</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">r</span><span class="blank">)</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug" class="type-reference" data-ref-type="type">Shift</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">a</span></span></code></pre></div></details></div><p><span class="span"><span class="rich source inline-code"><code class="inline-code"><span class="word">reset</span></code></span><span class="word">is the handler part, definable via:</span></span></p><div class="folded-sources"><details open="open" class="folded rich source"><summary class="folded-content folded-summary"><pre><code><span class="syntax"><span data-ref="#l6sv51t219kaivun4nmjl5ek3fb6d0uaqkh62c9lupecj161e6ppuv8klueo58m9t5goj3joaj9frfcb0sf6j58ik9nsur1ab0nk7uo" class="term-reference" data-ref-type="term"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">reset</span></span></span><span class="blank"> </span><span class="type-ascription-colon">: </span><span class="delay-force-char">&#39;</span><span class="ability-braces">{</span><span class="var">e</span><span class="blank">,</span><span class="blank"> </span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug" class="type-reference" data-ref-type="type">Shift</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span class="var">e</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span></span></code></pre></summary><div class="folded-content folded-details"><pre><code><span class="syntax"><span class="hash-qualifier"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">reset</span></span></span><span class="type-ascription-colon"> :</span><span class="blank"> </span><span class="delay-force-char">&#39;</span><span class="ability-braces">{</span><span class="var">e</span><span class="blank">,</span><span class="blank"> </span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug" class="type-reference" data-ref-type="type">Shift</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span class="var">e</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank">
</span><span class="hash-qualifier"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">reset</span></span></span><span class="blank"> </span><span class="var">e</span><span class="binding-equals"> =</span><span class="blank">
</span><span class="blank">  </span><span class="hash-qualifier">h</span><span class="binding-equals"> =</span><span class="blank"> </span><span class="control-keyword">cases</span><span class="blank">
</span><span class="blank">  </span><span class="blank">  </span><span class="delimeter-char">{</span><span class="blank"> </span><span class="var">x</span><span class="blank"> </span><span class="delimeter-char">}</span><span class="blank">          </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">x</span><span class="blank">
</span><span class="blank">  </span><span class="blank">  </span><span class="delimeter-char">{</span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug#a0" class="term-reference" data-ref-type="term">shift</span><span class="blank"> </span><span class="var">e</span><span class="blank"> </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">k</span><span class="delimeter-char">}</span><span class="blank"> </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">e</span><span class="blank"> </span><span class="parenthesis">(</span><span class="blank">x</span><span class="control-keyword"><span class="arrow"> -&gt;</span></span><span class="blank"> </span><span class="parenthesis">(</span><span class="control-keyword">handle</span><span class="blank"> </span><span class="var">k</span><span class="blank"> </span><span class="var">x</span><span class="blank"> </span><span class="control-keyword">with</span><span class="blank"> </span><span class="var">h</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="blank">
</span><span class="blank">  </span><span class="control-keyword">handle</span><span class="blank"> </span><span class="delay-force-char">!</span><span class="var">e</span><span class="blank"> </span><span class="control-keyword">with</span><span class="blank"> </span><span class="var">h</span></span></code></pre></div></details></div><p><span class="span"><span class="word">Then we can try the above example:</span></span></p><div class="source rich eval"><pre><code><div><span class="syntax"><span class="hash-qualifier">v</span><span class="binding-equals"> =</span><span class="blank">
</span><span class="blank">  </span><span class="use-keyword">use </span><span class="use-prefix">Nat</span><span class="blank"> </span><span class="use-suffix">+</span><span class="blank">
</span><span class="blank">  </span><span class="numeric-literal">1</span><span class="blank"> </span><span data-ref="##Nat.+" class="term-reference" data-ref-type="term">+</span><span class="blank"> </span><span class="numeric-literal">2</span><span class="blank"> </span><span data-ref="##Nat.+" class="term-reference" data-ref-type="term">+</span><span class="blank"> </span><span data-ref="#l6sv51t219kaivun4nmjl5ek3fb6d0uaqkh62c9lupecj161e6ppuv8klueo58m9t5goj3joaj9frfcb0sf6j58ik9nsur1ab0nk7uo" class="term-reference" data-ref-type="term"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">reset</span></span></span><span class="blank"> </span><span class="delay-force-char">&#39;</span><span class="parenthesis">(</span><span class="numeric-literal">1</span><span class="blank"> </span><span data-ref="##Nat.+" class="term-reference" data-ref-type="term">+</span><span class="blank"> </span><span class="numeric-literal">2</span><span class="blank"> </span><span data-ref="##Nat.+" class="term-reference" data-ref-type="term">+</span><span class="blank"> </span><span data-ref="#6tj468n4ukb0nm93rvebaj4rv2aov6h5414hbd6u97lobnpv7rhbshsklm10f11k9s29spuot17gi545bo663qi2jqb8f0p5neg7pug#a0" class="term-reference" data-ref-type="term">shift</span><span class="blank"> </span><span class="parenthesis">(</span><span class="blank">k</span><span class="control-keyword"><span class="arrow"> -&gt;</span></span><span class="blank"> </span><span class="var">k</span><span class="blank"> </span><span class="parenthesis">(</span><span class="var">k</span><span class="blank"> </span><span class="numeric-literal">5</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="blank"> </span><span data-ref="##Nat.+" class="term-reference" data-ref-type="term">+</span><span class="blank"> </span><span class="numeric-literal">3</span><span class="parenthesis">)</span><span class="blank">
</span><span class="var">v</span></span><div class="result">â§¨<div><span class="syntax"><span class="numeric-literal">20</span></span></div></div></div></code></pre></div><p><span class="span"><span class="word">One thing to notice is that these operations use a &quot;deep&quot; handler. Shallow handlers actually correspond more closely to another pair of operations known as</span><span class="rich source inline-code"><code class="inline-code"><span class="word">control</span></code></span><span class="word">(similar to</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">shift</span></code></span><span class="word">)</span></span></span><span class="word">and</span><span class="rich source inline-code"><code class="inline-code"><span class="word">prompt</span></code></span><span class="word">(similar to</span><span class="group"><span class="join"><span class="rich source inline-code"><code class="inline-code"><span class="word">reset</span></code></span><span class="word">).</span></span></span><span class="word">A Unison version of these might be defined something like:</span></span></p><div class="folded-sources"><details open="open" class="folded rich source"><summary class="folded-content folded-summary"><pre><code><span class="syntax"><span class="data-type-modifier">structural</span><span class="blank"> </span><span class="data-type-keyword">ability</span><span class="blank"> </span><span class="hash-qualifier">Control</span><span class="blank"> </span><span class="data-type-params">r</span></span></code></pre></summary><div class="folded-content folded-details"><pre><code><span class="syntax"><span class="data-type-modifier">structural</span><span class="blank"> </span><span class="data-type-keyword">ability</span><span class="blank"> </span><span class="hash-qualifier">Control</span><span class="blank"> </span><span class="data-type-params">r</span><span class="control-keyword"> where</span><span class="blank">
</span><span class="blank">  </span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o#a0" class="term-reference" data-ref-type="term">control</span><span class="type-ascription-colon"> :</span><span class="blank"> </span><span class="blank">(</span><span class="blank">(</span><span class="var">a</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o" class="type-reference" data-ref-type="type">Control</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank">)</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">r</span><span class="blank">)</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o" class="type-reference" data-ref-type="type">Control</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">a</span></span></code></pre></div></details></div><div class="folded-sources"><details open="open" class="folded rich source"><summary class="folded-content folded-summary"><pre><code><span class="syntax"><span data-ref="#fcih3lmvfgmgn6d7jf6g7h3ldt1uokhu4sq8qlh91lom5dbludabiprqcm9gbdq5u0lbepoafvsk61t9aqvr0ffgtglf3kl691e588g" class="term-reference" data-ref-type="term"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">prompt</span></span></span><span class="blank"> </span><span class="type-ascription-colon">: </span><span class="delay-force-char">&#39;</span><span class="ability-braces">{</span><span class="var">e</span><span class="blank">,</span><span class="blank"> </span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o" class="type-reference" data-ref-type="type">Control</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span class="var">e</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span></span></code></pre></summary><div class="folded-content folded-details"><pre><code><span class="syntax"><span class="hash-qualifier"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">prompt</span></span></span><span class="type-ascription-colon"> :</span><span class="blank"> </span><span class="delay-force-char">&#39;</span><span class="ability-braces">{</span><span class="var">e</span><span class="blank">,</span><span class="blank"> </span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o" class="type-reference" data-ref-type="type">Control</span><span class="blank"> </span><span class="var">r</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank"> </span><span class="type-operator"><span class="arrow">-&gt;</span></span><span class="ability-braces">{</span><span class="var">e</span><span class="ability-braces">}</span><span class="blank"> </span><span class="var">r</span><span class="blank">
</span><span class="hash-qualifier"><span class="fqn"><span class="segment">jitAnnounce</span><span class="sep ">.</span><span class="segment">prompt</span></span></span><span class="blank"> </span><span class="var">e</span><span class="binding-equals"> =</span><span class="blank">
</span><span class="blank">  </span><span class="control-keyword">handle</span><span class="blank"> </span><span class="delay-force-char">!</span><span class="var">e</span><span class="blank">
</span><span class="blank">  </span><span class="control-keyword">with</span><span class="blank">
</span><span class="blank">  </span><span class="blank">  </span><span class="control-keyword">cases</span><span class="blank">
</span><span class="blank">  </span><span class="blank">  </span><span class="blank">  </span><span class="delimeter-char">{</span><span class="blank"> </span><span class="var">x</span><span class="blank"> </span><span class="delimeter-char">}</span><span class="blank">            </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">x</span><span class="blank">
</span><span class="blank">  </span><span class="blank">  </span><span class="blank">  </span><span class="delimeter-char">{</span><span data-ref="#522uj9mq8rmmkfhk8jmn5cenecqu777lhfhhp81mehieqhakqiiq5ccvqsjqt6501ogm3ns3fc4uno1pfv6gjhe4flo4horae6t244o#a0" class="term-reference" data-ref-type="term">control</span><span class="blank"> </span><span class="var">e</span><span class="blank"> </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">k</span><span class="delimeter-char">}</span><span class="blank"> </span><span class="control-keyword"><span class="arrow">-&gt;</span></span><span class="blank"> </span><span class="var">e</span><span class="blank"> </span><span class="var">k</span></span></code></pre></div></details></div><p><span class="span"><span class="word">Although I haven&#39;t experimented much with them, so I&#39;m not sure how precisely they match the theoretical definitions.</span></span></p></section><div class="tooltips" style="display: none;"></div></article>